if [ -f package.json ]; then \
    echo "--- :javascript: Installing JavaScript deps" \
    && yarn install --frozen-lockfile --cache-folder ~/.cache/yarn
elif [ -f actionview/package.json ]; then \
    echo "--- :javascript: Installing JavaScript deps" \
    && (cd actionview && npm install); \
fi

echo "--- :bundler: Installing Ruby deps" \
    && (cd tmp && for f in *.gemspec; do d="$(basename -s.gemspec "$f")"; mkdir -p "../$d" && mv "$f" "../$d/"; done) \
    && rm Gemfile.lock && bundle install -j 8 --path vendor/bundle

if [ -f package.json ]; then \
    echo "--- :javascript: Building JavaScript package" \
    && (cd actionview && yarn build) \
    && if [ -f railties/test/isolation/assets/package.json ]; then \
        (cd railties/test/isolation/assets && yarn install --frozen-lockfile --cache-folder ~/.cache/yarn); \
    fi \
fi
